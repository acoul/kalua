#!/bin/sh
. /tmp/loader

# this runs every 60 sec, so should be fast.
# It is needed *after* a station has disconnected,
# so we lookup and store the *last* seen stats

stats_ap_clients()
{
	local list_devs dev

	read -r list_devs <"$TMPDIR/WIFI_DEVS_AP" || return
	for dev in $list_devs; do {
		iw dev "$dev" station dump
	} done
}

stats_ap_clients >"$TMPDIR/WIFI_DEVS_AP_STATS.tmp" && {
	mv "$TMPDIR/WIFI_DEVS_AP_STATS.tmp" "$TMPDIR/WIFI_DEVS_AP_STATS"
}

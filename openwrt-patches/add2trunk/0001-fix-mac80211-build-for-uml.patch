From 16cbe45c30f6d812fbeb910e61f141de1fac7fca Mon Sep 17 00:00:00 2001
From: mt <mt@i3o.de>
Date: Sat, 13 Jun 2015 14:16:07 +0200
Subject: [PATCH] fix mac80211 build for uml

---
 package/kernel/mac80211/Makefile                        |  1 -
 package/kernel/mac80211/patches/010-fix-uml-build.patch | 15 +++++++++++++++
 2 files changed, 15 insertions(+), 1 deletion(-)
 create mode 100644 package/kernel/mac80211/patches/010-fix-uml-build.patch

diff --git a/package/kernel/mac80211/Makefile b/package/kernel/mac80211/Makefile
index 2af5d39..068ea67 100644
--- a/package/kernel/mac80211/Makefile
+++ b/package/kernel/mac80211/Makefile
@@ -60,7 +60,7 @@ define KernelPackage/mac80211/Default
   SUBMENU:=$(WMENU)
   URL:=https://wireless.wiki.kernel.org/
   MAINTAINER:=Felix Fietkau <nbd@openwrt.org>
-  DEPENDS:=@!TARGET_uml @!LINUX_4_1
+  DEPENDS:=@!LINUX_4_1
 endef
 
 define KernelPackage/cfg80211
diff --git a/package/kernel/mac80211/patches/010-fix-uml-build.patch b/package/kernel/mac80211/patches/010-fix-uml-build.patch
new file mode 100644
index 0000000..0d53e08
--- /dev/null
+++ b/package/kernel/mac80211/patches/010-fix-uml-build.patch
@@ -0,0 +1,15 @@
+--- a/backport-include/asm/barrier.h
++++ b/backport-include/asm/barrier.h
+@@ -1,9 +1,9 @@
+-#ifndef __BACKPORT_ASM_GENERIC_BARRIER_H
+-#define __BACKPORT_ASM_GENERIC_BARRIER_H
++#ifndef __BACKPORT_ASM_BARRIER_H
++#define __BACKPORT_ASM_BARRIER_H
+ #include_next <asm/barrier.h>
+ 
+ #ifndef dma_rmb
+ #define dma_rmb()	rmb()
+ #endif
+ 
+-#endif /* __BACKPORT_ASM_GENERIC_BARRIER_H */
++#endif /* __BACKPORT_ASM_BARRIER_H */
-- 
1.9.1

